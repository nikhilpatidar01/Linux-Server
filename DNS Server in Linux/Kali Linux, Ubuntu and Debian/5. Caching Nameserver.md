
## **Caching Nameserver Configuration for Kali Linux, Ubuntu, and Debian**  

---

## **1. Check and Update Hostname**  
### **Display Current Hostname**  
```bash
hostnamectl
```

### **Update Hostname**  
```bash
 hostnamectl set-hostname your-new-hostname
```

### **Verify the Change**  
```bash
hostnamectl
```

---

## **2. Check DNS Resolver Configuration**  
### **View `/etc/resolv.conf` for DNS Settings**  
```bash
cat /etc/resolv.conf
```
#### **Example Output:**
```
nameserver 8.8.8.8
nameserver 8.8.4.4
```

---

## **3. Install and Configure BIND**  
### **Check if BIND is Installed**  
```bash
dpkg -l | grep bind9
```

### **Install BIND and Utilities**  
```bash
 apt update
 apt install bind9 bind9-utils -y
```

### **Verify Installation**  
```bash
dpkg -l | grep bind9
```

### **Get Information About the Installed Package**  
```bash
dpkg -s bind9
```

---

## **4. Key Configuration Files**
### **Main Configuration Files:**
- `/etc/bind/named.conf` – Main configuration file for BIND.
- `/etc/bind/named.conf.options` – Configuration options for the nameserver.
- `/etc/bind/named.conf.local` – Defines custom zones.
- `/etc/bind/db.root` – Root trust anchor file.

### **Working Directories:**
- `/var/cache/bind/` – Stores zone files and cache data.
- `/etc/bind/db.local` – Defines the localhost zone.
- `/etc/bind/db.127` – Reverse lookup for 127.0.0.1.
- `/etc/bind/db.empty` – Defines empty zones.

---

## **5. Manage BIND Service**  
### **Check Service Status**  
```bash
 systemctl status bind9
```

### **Start the Service**  
```bash
 systemctl start bind9
```

### **Enable Service on Boot**  
```bash
 systemctl enable bind9
```

---

## **6. Configure Firewall Rules (UFW)**  
### **Allow DNS Traffic (TCP and UDP Port 53)**  
```bash
 ufw allow 53/tcp
 ufw allow 53/udp
 ufw reload
```

### **Check Open Ports for BIND**  
```bash
 netstat -tulnp | grep named
 netstat -tulnp | grep 53
```

### **Test Using `dig`**
```bash
dig google.com @127.0.0.1
```

---

## **7. Configure Network Settings**  
### **Modify Network Configuration File (Ubuntu & Debian)**  
Edit the network settings:
```bash
 nano /etc/netplan/01-netcfg.yaml
```
#### **Example:**
```yaml
network:
  ethernets:
    enp0s3:
      dhcp4: no
      addresses:
        - 192.168.1.37/24
      gateway4: 192.168.1.1
      nameservers:
        addresses: [127.0.0.1, 8.8.8.8]
  version: 2
```

### **Apply Changes**
```bash
 netplan apply
```

---

## **8. Configure BIND (`named.conf.options`)**  
Edit the BIND configuration file:  
```bash
 nano /etc/bind/named.conf.options
```

#### **Configuration Data:**
```bash
options {
    directory "/var/cache/bind";

    listen-on port 53 { 127.0.0.1; 192.168.1.37; };
    allow-query { localhost; 192.168.1.0/24; };
    recursion yes;
    dnssec-validation auto;
};
```

### **Restart BIND Service**
```bash
 systemctl restart bind9
```

---

## **9. Define ACL in named.conf**  
### **Edit Configuration File**  
```bash
 nano /etc/bind/named.conf.options
```

### **Configuration Data**
```bash
acl ns_ip_add {
    127.0.0.1;
    192.168.1.37;
    192.168.1.38;
    192.168.1.39;
};

acl mynetwork {
    127.0.0.1;
    192.168.1.0/24;
};

options {
    listen-on port 53 { ns_ip_add; };
    directory "/var/cache/bind";
    allow-query { mynetwork; };
    recursion yes;
    dnssec-validation auto;
};
```

---

## **10. Restart Services**  
### **Restart BIND Service**  
```bash
 systemctl restart bind9
```

### **Restart Firewall**
```bash
 systemctl restart ufw
```

---

## **11. Test Setup**  
### **Use `dig` to Test DNS Resolution**  
```bash
dig google.com @192.168.1.37
```
```bash
dig youtube.com @192.168.1.37
```

---

## **12. Capture DNS Traffic Using tcpdump**  
### **Basic UDP Traffic Capture**  
```bash
 tcpdump -t udp
```

### **Capture DNS Traffic on a Specific Interface**  
```bash
 tcpdump -i enp0s3 port 53 
```

### **Capture DNS Queries and Responses**  
```bash
 tcpdump -n udp port 53
```

---
