# **Caching Nameserver Setup Guide**

## **Introduction**
A **caching nameserver** temporarily stores DNS query results to improve performance and reduce the load on authoritative nameservers. This guide covers the setup and configuration of a caching nameserver using **BIND (Berkeley Internet Name Domain)**.

---

## **1. Check and Update Hostname**
### **Display Current Hostname**
```bash
hostname
```

### **Update Hostname**
Open the hostname configuration file:
```bash
vim /etc/hostname
```
Modify the hostname value as needed, then save and exit.

### **Reboot the System**
```bash
reboot
```

### **Confirm the Hostname Change**
```bash
hostname
```

---

## **2. Check DNS Resolver Configuration**
### **View `/etc/resolv.conf` for DNS Settings**
```bash
cat /etc/resolv.conf
```
Example:
```
nameserver 8.8.8.8
nameserver 8.8.4.4
```

---

## **3. Install and Configure BIND**
### **Check if BIND is Installed**
```bash
rpm -qa | grep bind
```

### **Install BIND and Utilities**
```bash
yum install bind bind-utils -y
```

### **Verify Installation**
```bash
rpm -qa | grep bind
```

### **Get Information About the Installed Package**
```bash
rpm -qi bind
```

### **List Installed Files**
```bash
rpm -ql bind
```

### **List Configuration Files**
```bash
rpm -qc bind
```

---

## **4. Key Configuration Files**
### **Main Configuration Files:**
- `/etc/named.conf` – Main configuration file for BIND.
- `/etc/named.iscdlv.key` – Contains TSIG (Transaction Signature) keys.
- `/etc/named.rfc1912.zones` – Defines default zones (e.g., localhost, reverse lookups).
- `/etc/named.root.key` – Root trust anchor key for DNSSEC.

### **Working Directories:**
- `/var/named/` – Stores zone files and cache data.
- `/var/named/data/` – Stores BIND-generated data files.
- `/var/named/dynamic/` – Stores dynamically generated zone files.
- `/var/named/named.ca` – Contains the list of root DNS servers.
- `/var/named/named.empty` – Defines empty zones.
- `/var/named/named.localhost` – Defines the zone for localhost.
- `/var/named/named.loopback` – Reverse lookup for 127.0.0.1.
- `/var/named/slaves/` – Stores slave zone files.

### **View Cache File**
```bash
cat /var/named/named.ca
```

---

## **5. Manage BIND Service**
### **Check Service Status**
```bash
systemctl status named.service
```

### **Start the Service**
```bash
systemctl start named.service
```

### **Check Open Ports for Named**
```bash
netstat -nltup | grep named
netstat -nltup | grep 53
```

### **Test Using `dig`**
```bash
dig google.com @127.0.0.1
```

---

## **6. Configure Network Settings**
### **Modify Network Interface Configuration (CentOS 7)**
Edit the network interface file:
```bash
vim /etc/sysconfig/network-scripts/ifcfg-enp0s3
```
Example:
```
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
IPADDR=192.168.1.37
PREFIX=24
GATEWAY=192.168.1.1
DNS1=127.0.0.1
ONBOOT=yes
```

### **Modify NetworkManager Connection Configuration**
```bash
vim /etc/NetworkManager/system-connections/enp0s3.nmconnection
```
Example:
```
[connection]
id=enp0s3
uuid=5dabe1f1-79aa-3751-8ba8-b0f01d817434
type=ethernet
[ipv4]
address1=192.168.1.32/24
dns=127.0.0.1;
method=manual
```

---

## **7. Configure BIND (named.conf)**
Edit the BIND configuration file:
```bash
vim /etc/named.conf
```
Example:
```
options {
    listen-on port 53 { 127.0.0.1; 192.168.1.34; };
    directory "/var/named";
    dump-file "/var/named/data/cache_dump.db";
    statistics-file "/var/named/data/named_stats.txt";
    recursion yes;
    allow-query { 127.0.0.1; 192.168.1.0/24; };
    dnssec-validation yes;
};
```

---

## **8. Configure Firewall Rules (Firewalld)**
### **Allow DNS Traffic (TCP and UDP Port 53)**
```bash
firewall-cmd --permanent --add-port=53/tcp
firewall-cmd --permanent --add-port=53/udp
firewall-cmd --reload
```

---

## **9. Define ACL in named.conf**
```bash
vim /etc/named.conf
```
Example:
```
acl mynetwork {
    127.0.0.1;
    192.168.1.0/24;
};
options {
    listen-on port 53 { 127.0.0.1; 192.168.1.34; };
    allow-query { mynetwork; };
    recursion yes;
};
```

---

## **10. Restart Services**
### **Restart BIND Service**
```bash
systemctl restart named.service
```

### **Restart Firewall**
```bash
systemctl restart firewalld.service
```

---

## **11. Test Setup**
### **Use `dig` to Test DNS Resolution**
```bash
dig google.com @192.168.1.50
```

### **Check Firewall Rules**
```bash
iptables -n -L INPUT
```

---

