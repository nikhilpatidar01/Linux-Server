# 3.  Rsync Commands üîπ

---

## Install Rsync on CentOS or RHEL

```bash
yum install rsync
```

### Explanation:
- Installs the `rsync` tool on CentOS or RHEL systems using `yum` package manager.

---

## Sync a Directory from Remote Server to Local Machine (Backup)

```bash
rsync -av root@192.168.1.34:/var/log/ /tmp/
```
```bash
rsync -az root@192.168.1.34:/var/log/ /tmp/
```

### Explanation:
- `-a` : Archive mode, preserving file permissions, timestamps, symbolic links, etc.
- `-v` : Verbose mode, showing detailed progress.
- `-z` : Compress file data during the transfer for faster speed (used in the second command).
- `root@192.168.1.34:/var/log/` : Source directory on the remote server.
- `/tmp/` : Destination directory on the local machine.

---

## Upload Files or Directory from Local Machine to Remote Server

```bash
rsync -av /tmp/log/ root@192.168.1.34:/var/
```
```bash
rsync -az /tmp/log/ root@192.168.1.34:/var/
```

### Explanation:
- `-a` : Archive mode.
- `-v` : Verbose mode.
- `-z` : Compress file data during transfer.
- `/tmp/log/` : Source directory on the local machine.
- `root@192.168.1.34:/var/` : Destination directory on the remote server.

---

## Secure Rsync Transfer Using a Private SSH Key

```bash
rsync -av -e 'ssh -i ~/.ssh/id_rsa' root@192.168.1.34:/var/log/ /tmp/log/
```

### Explanation:
- `-a` : Archive mode.
- `-v` : Verbose mode.
- `-e 'ssh -i ~/.ssh/id_rsa'` : Use SSH with a specific private key file (`id_rsa`) for authentication.
- `root@192.168.1.34:/var/log/` : Source directory on the remote server.
- `/tmp/log/` : Destination directory on the local machine.

---

## Run Rsync Over a Non-Default SSH Port

```bash
rsync -av -e 'ssh -p 2200' /backup/ root@192.168.1.100:/mnt/backup/
```

### Explanation:
- `-a` : Archive mode.
- `-v` : Verbose mode.
- `-e 'ssh -p 2200'` : Use SSH and connect over port `2200` instead of the default port `22`.
- `/backup/` : Source directory on the local machine.
- `root@192.168.1.100:/mnt/backup/` : Destination directory on the remote machine.


---

# Safety and Simulation

## Perform a Dry Run  
Preview changes **without making them**.

```bash
rsync -av --dry-run ~/Documents root@192.168.1.34:/var/log/tmp/
```

### Explanation:
- `rsync` : The command to synchronize files between two locations.
- `-a` : Archive mode, preserving file attributes (permissions, timestamps, symbolic links, etc.).
- `-v` : Verbose mode, showing detailed output of the files that would be affected.
- `--dry-run` : Simulates the transfer, allowing you to preview what will happen without making any actual changes.
- `~/Documents` : The source directory on your local machine.
- `root@192.168.1.34:/var/log/tmp/` : The destination directory on the remote machine (IP `192.168.1.34`), where the files would be copied.

---

# Delete Extra Files on Remote

## Mirror the local directory exactly.

```bash
rsync -av --delete ~/projects root@192.168.1.34:/var/log/
```

### Explanation:
- `rsync` : The command to synchronize files between two locations.
- `-a` : Archive mode, preserving permissions, symbolic links, timestamps, etc., during transfer.
- `-v` : Enables verbose mode, showing detailed output of the file transfer process.
- `--delete` : Removes files from the destination (`/var/log/` on the remote machine) that no longer exist in the source (`~/projects` on the local machine).
- `~/projects` : The source directory on your local machine.
- `root@192.168.1.34:/var/log/` : The destination directory on the remote machine (IP `192.168.1.34`), under the `/var/log/` path.


---





# Advanced Rsync Usage üîπ

---

## Show Transfer Progress
```bash
rsync -av --progress largefile.iso root@192.168.1.34:/iso/
```
- `rsync` : Synchronize (copy) files between locations.
- `-a` : Archive mode ‚Äî preserves permissions, timestamps, symbolic links, etc.
- `-v` : Verbose mode ‚Äî shows detailed output.
- `--progress` : Show real-time progress during file transfer (percentage, speed, ETA).
- `largefile.iso` : File to transfer from local machine.
- `root@192.168.1.34:/iso/` : Destination path on the remote machine.

---

## Sync Only Specific File Types
```bash
rsync -av --include='*.jpg' --exclude='*' /photos/ root@192.168.1.34:/backup/images/
```
- `--include='*.jpg'` : Only include `.jpg` files for transfer.
- `--exclude='*'` : Exclude all other files except `.jpg`.
- `/photos/` : Source directory.
- `root@192.168.1.34:/backup/images/` : Destination directory.

---

## Preserve Symlinks
```bash
rsync -av -l /var/www/ root@192.168.1.34:/www/
```
- `-l` : Preserve symbolic links ‚Äî copies the symlink itself, not the file it points to.

---

## Enable Partial Transfers
```bash
rsync -av --partial --progress bigfile.iso root@192.168.1.34:/iso/
```
- `--partial` : Keep partially transferred files if interrupted (helpful for resuming).

---

## Create Verbose Log File
```bash
rsync -av --log-file=/var/log/rsync-backup.log /data/ root@192.168.1.34:/backup/data/
```
- `--log-file=/var/log/rsync-backup.log` : Log the full details of the transfer to a file.

---

## Backup With Timestamp
```bash
rsync -av /data/ root@192.168.1.34:/backup/$(date +%F)/
```
- `$(date +%F)` : Dynamically create a folder with the current date (`YYYY-MM-DD` format).

---

## Remove Source Files After Transfer
```bash
rsync -av --remove-source-files /export/logs/ root@192.168.1.34:/logs/
```
- `--remove-source-files` : Deletes files from source **after** successful transfer (only files, not directories).

---

## Limit Bandwidth
```bash
rsync -av --bwlimit=500 /iso/ root@192.168.1.34:/mnt/iso/
```
- `--bwlimit=500` : Limits bandwidth usage to **500 KB/s** (not MB).

---

## Use Checksums To Detect Changes
```bash
rsync -avc /important/ root@192.168.1.34:/verified_backup/
```
- `-c` : Use checksums instead of just timestamps+size to detect file changes. (Ensures maximum accuracy but is slower.)

---

## Skip Newer Files On Remote
```bash
rsync -av --ignore-existing /media/photos/ root@192.168.1.34:/album/
```
- `--ignore-existing` : Do **not** overwrite files that already exist on the remote destination.

---

## Exclude Files Or Directories

Exclude a directory:
```bash
rsync -av --exclude 'node_modules' ~/project/ root@192.168.1.34:/deploy/
```
- `--exclude 'node_modules'` : Skip the `node_modules` directory during transfer.

Exclude multiple patterns:
```bash
rsync -av --exclude '*.log' --exclude 'tmp/' /var/www/ root@192.168.1.34:/backup/
```
- `--exclude '*.log'` : Skip all `.log` files.
- `--exclude 'tmp/'` : Skip the `tmp/` directory.

---

## Rsync Script With SSH Key
```bash
#!/bin/bash

rsync -az -e "ssh -i ~/.ssh/id_rsa" /data/ root@192.168.1.34:/mnt/data/
```
- `-z` : Compress file data during transfer (saves bandwidth).
- `-e "ssh -i ~/.ssh/id_rsa"` : Use specific private key for authentication.

---

## Rsync From One Remote Server To Another
```bash
rsync -av -e ssh root@192.168.1.10:/var/www/ root@192.168.1.20:/backup/www/
```
- Transfer data **directly** between two remote servers via your machine (data does not touch your local).

---

## Show Only Differences (Dry Run)
```bash
rsync -n -av --itemize-changes ~/projects/ root@192.168.1.34:/var/www/
```
- `-n` : Dry run ‚Äî shows what would be transferred but doesn't actually copy.
- `--itemize-changes` : Show detailed list of what changes would happen.

---

## Rsync On Windows (WSL Or Git Bash)
```bash
rsync -av /c/Users/Name/Documents/ root@192.168.1.34:/home/name/
```
- On Windows, paths like `/c/Users/...` are used in WSL or Git Bash.

---

# üñ•Ô∏è Windows SSH Tools

---

## Putty and Puttygen
- **Putty** : SSH/Telnet/SCP client for Windows.
- **Puttygen** : Tool to generate `.ppk` keys for Putty.

üîó [Download Putty and Puttygen](https://www.puttygen.com/download-putty)

---

## WinSCP
- GUI-based file transfer client for SSH (SFTP and SCP).
- Supports drag-and-drop file uploads and `.ppk` key usage.

üîó [Download WinSCP](https://winscp.net/eng/download.php)

---

# üîí SSH Tips and Automation

---

## Start SSH Agent and Add Private Key
```bash
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_rsa
```
- Starts ssh-agent and loads your private key into memory.

---

## Use SSH Config for Easy Aliases
Edit or create `~/.ssh/config`:
```bash
Host devserver
   HostName 192.168.1.34
   User root
   Port 2222
   IdentityFile ~/.ssh/id_rsa
```
Now you can just connect by typing:
```bash
ssh devserver
```

---

## Disable Host Key Checking (Automation Only)
```bash
ssh -o StrictHostKeyChecking=no root@192.168.1.100
```
- **‚ö†Ô∏è Warning:** Disabling host key check is insecure but useful for automation/scripts.

---

# üö® SSH Security Tips
- Prefer **Public/Private Key** authentication over passwords.
- Set `PermitRootLogin no` in `/etc/ssh/sshd_config`.
- Use `AllowUsers` in SSH config to restrict who can login.
- Use **firewalls** to limit SSH access (UFW/iptables).
- Install and configure **fail2ban** to block IPs with multiple failed logins.
- Regularly update your SSH server and client software for latest security patches.

---
