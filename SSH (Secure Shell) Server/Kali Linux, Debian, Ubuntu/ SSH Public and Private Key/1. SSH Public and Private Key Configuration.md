
### 🔐 **What is RSA?** (Simple Explanation)

**RSA** is an **encryption technique** used for secure communication — like in **SSH**.

- **Full form:** Rivest–Shamir–Adleman  
- **Type:** Asymmetric (uses 2 keys)
  - **Public Key:** Shared with others
  - **Private Key:** Kept secret by you

---

### 🔑 **How Does RSA Work?**
- Your **public key** is stored on the server.
- Your **private key** stays safe on your system.
- When you log in, the server checks if the private key matches the public key.
- If they match → secure login happens.

---

### 📌 **Where is RSA Used?**
- SSH login
- Website security (HTTPS)
- Digital signatures

---

# SSH Public and Private Key Configuration Guide (Kali Linux / Debian / Ubuntu)

This guide explains how to generate SSH keys, configure the SSH daemon (`sshd`), and set up secure SSH access for both root and a custom user (e.g., `nikhil`).

---

## 🛠️ SSH Key Generation and Server Configuration

### 1. Edit SSH Daemon Configuration

Open the config file:

```bash
 nano /etc/ssh/sshd_config
```

Make sure these lines exist and are **not commented**:

```ini
PermitRootLogin yes
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM yes
```

Save the file and exit (`Ctrl + O`, then `Enter`, then `Ctrl + X`).

---

### 2. Generate SSH Key Pair (RSA) as Non-Root User

Switch to the user (e.g., `nikhil`) and generate the key:

```bash
 su - nikhil
```
Generate the Key
```bash
ssh-keygen -t rsa
```

Keys will be saved in `~/.ssh/`:
- `id_rsa` – Private key
- `id_rsa.pub` – Public key

---

### 3. Authorize SSH Key for Root Login


Copy the public key into the root user's authorized keys:

```bash
cd /root/.ssh/
```
Paste the public key content into the file /root/.ssh/authorized_keys
```bash
cp /home/nikhil/.ssh/id_rsa.pub /root/.ssh/authorized_keys
```
or

```bash
echo "/home/nikhil/.ssh/id_rsa.pub" >> /root/.ssh/authorized_keys
```

Ensure the `authorized_keys` file has the correct permissions:

```bash
chmod 600 /root/.ssh/authorized_keys
```

📝 **Short Tip:** This means you're allowing root login using the public key generated by user `nikhil`.

---

### 4. Restart SSH Service

Restart SSH to apply changes:

```bash
 systemctl restart ssh
```

---

### 5. Verify SSH Service Status

Check if SSH is running:

```bash
 ss -nltup | grep sshd
```

✅ You can now log in as root from another machine without a password:

```bash
ssh root@192.168.95.145
```

---

## 🔑 Using Private Key from Another Machine

### 1. Save the private key:

Create the file:

```bash
nano id_rsa_kali
```

Paste the content of the private key and save (`Ctrl + O`, `Enter`, `Ctrl + X`).

### 2. Set permissions:

```bash
chmod 600 id_rsa_kali
```

### 3. Connect:

```bash
ssh -i id_rsa_kali root@192.168.95.145
```

---

## 👤 DSA Key Pair for Custom User (nikhil)

### 1. Generate DSA Key Pair

```bash
ssh-keygen -t dsa -f /tmp/id_dsa -q -N "Ormour123"
```

This creates:
- `/tmp/id_dsa` (private key)
- `/tmp/id_dsa.pub` (public key)

---

### 2. Prepare SSH Directory

```bash
 mkdir -p /home/nikhil/.ssh
ls -lha /home/nikhil | grep .ssh
```

---

### 3. Copy Public Key

```bash
 cp /tmp/id_dsa.pub /home/nikhil/.ssh/authorized_keys
ls -lha /home/nikhil/.ssh/
```

---

### 4. Set Correct Ownership

```bash
 chown -R nikhil:nikhil /home/nikhil/.ssh/
```

---

### 5. Use DSA Key to Connect

Edit and save the private key on the client machine:

```bash
nano id_dsa_nikhil
```

Set permissions:

```bash
chmod 600 id_dsa_nikhil
```

Connect:

```bash
ssh -i id_dsa_nikhil nikhil@<hostname-or-IP>
```

---

## 🔐 SSH Daemon Configuration Example

Full sample of `/etc/ssh/sshd_config` for Debian/Ubuntu/Kali:

```ini
PermitRootLogin yes
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM yes
X11Forwarding yes
Subsystem sftp /usr/lib/openssh/sftp-server
```

> 🔁 **Note:** Debian-based distros use `/usr/lib/openssh/sftp-server` instead of `/usr/libexec/openssh/sftp-server`.

---

## 🧰 `ssh-add` Command Cheat Sheet

`ssh-add` manages keys in the `ssh-agent`.

### 🔸 Basic Commands

| Command | Description |
|--------|-------------|
| `ssh-add` | Adds default key (`~/.ssh/id_rsa`) |
| `ssh-add /path/to/key` | Add a specific key |
| `ssh-add -l` | List loaded key fingerprints |
| `ssh-add -L` | List loaded public keys |
| `ssh-add -d /path/to/key` | Remove a specific key |
| `ssh-add -D` | Remove all keys |
| `ssh-add -c /path/to/key` | Ask for confirmation before use |
| `ssh-add -t 3600 /path/to/key` | Add with timeout |
| `ssh-add -s /path/to/pkcs11.so` | Load smartcard key |
| `ssh-add -e /path/to/pkcs11.so` | Remove smartcard key |

---



### Example Commands

- **Start `ssh-agent` and add a private key:**
  ```bash
  eval "$(ssh-agent -s)"
  ssh-add ~/.ssh/id_rsa
  ```

- **List all public keys loaded:**
  ```bash
  ssh-add -L
  ```

- **Remove a specific key:**
  ```bash
  ssh-add -d ~/.ssh/id_rsa
  ```

- **Remove all keys from the agent:**
  ```bash
  ssh-add -D
  ```

- **Add key with 10-minute timeout:**
  ```bash
  ssh-add -t 600 ~/.ssh/id_ed25519
  ```

- **Add a key and ask for confirmation before each use:**
  ```bash
  ssh-add -c ~/.ssh/id_rsa
  ```



---

## 💡 Additional Tips

- ✅ Use **strong passphrases** when creating private keys.
- 🔐 Always keep your **private key** secure.
- 🔁 Change the default port `22` to reduce SSH brute force attempts.
- 🔥 Use **UFW**, **iptables**, or **fail2ban** to limit login attempts.
- 📦 Backup your `~/.ssh/` directory regularly.

---
