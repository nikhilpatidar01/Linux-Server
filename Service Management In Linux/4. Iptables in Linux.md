
# **IPTables Configuration Guide (CentOS)**
## **1Ô∏è‚É£ Search for IPTables Packages**
Check if IPTables is already installed:  
```bash
rpm -qa | grep iptables
```
Search for available IPTables packages:  
```bash
yum search iptables
```

---

## **2Ô∏è‚É£ Install IPTables Legacy and Utilities**
Install IPTables services and utilities:  
```bash
yum install -y iptables-services iptables-utils
```
If using **CentOS 8+**, install legacy version:  
```bash
yum install -y iptables-legacy
```

---

## **3Ô∏è‚É£ Verify IPTables Installation**
Check installed IPTables packages:  
```bash
rpm -qa | grep iptables
```
Get detailed package information:  
```bash
rpm -qi iptables
```
List all files related to IPTables:  
```bash
rpm -ql iptables
```
Check IPTables configuration files:  
```bash
rpm -qc iptables
```

---

## **4Ô∏è‚É£ Managing IPTables Service**
### **Enable and Start IPTables**
Enable IPTables to start on boot:  
```bash
systemctl enable iptables
systemctl enable ip6tables  # For IPv6
```
Start the IPTables service:  
```bash
systemctl start iptables
systemctl start ip6tables  # For IPv6
```
### **Stop and Disable Firewalld (if running)**
CentOS comes with **firewalld** enabled by default, disable it:  
```bash
systemctl stop firewalld
systemctl disable firewalld
systemctl mask firewalld
```
Check if **IPTables is active**:  
```bash
systemctl status iptables
```

---

## **5Ô∏è‚É£ Listing and Flushing Rules**
### **List all IPTables rules**
```bash
iptables -L -n -v
```
Show rules with line numbers:  
```bash
iptables -L --line-numbers
```
List OUTPUT chain rules:  
```bash
iptables -L OUTPUT --line-numbers
```

### **Flush (Clear) all rules**
```bash
iptables -F
iptables -X
iptables -Z
```
Reset all rules and set default policy to DROP:  
```bash
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT
```

---

## **6Ô∏è‚É£ Configuring IPTables Rules**
### **Allow Essential Services**
Allow all established connections:  
```bash
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
```
Allow localhost (loopback interface):  
```bash
iptables -A INPUT -i lo -j ACCEPT
```
Allow SSH (port 22) from a specific IP:  
```bash
iptables -A INPUT -p tcp --dport 22 -s 192.168.1.100 -j ACCEPT
```
Allow HTTP (port 80) and HTTPS (port 443):  
```bash
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
```
Allow FTP (port 21):  
```bash
iptables -A INPUT -p tcp --dport 21 -j ACCEPT
```

### **Allow Specific UDP Services**
Allow DNS (UDP 53):  
```bash
iptables -A INPUT -p udp --dport 53 -j ACCEPT
```
Allow DHCP (UDP 67, 68):  
```bash
iptables -A INPUT -p udp --dport 67 -j ACCEPT
iptables -A INPUT -p udp --dport 68 -j ACCEPT
```

---

## **7Ô∏è‚É£ Blocking Specific Traffic**
Block SSH (port 22) for a specific IP:  
```bash
iptables -A INPUT -p tcp --dport 22 -s 192.168.1.50 -j DROP
```
Block all ICMP (ping) requests:  
```bash
iptables -A INPUT -p icmp -j DROP
```
Block traffic to Google:  
```bash
iptables -A OUTPUT -d google.com -p tcp --dport 80 -j DROP
```
Block Facebook access (HTTPS):  
```bash
iptables -A OUTPUT -d www.facebook.com -p tcp --dport 443 -j DROP
```

---

## **8Ô∏è‚É£ Logging and Dropping Unknown Traffic**
Enable logging for dropped packets:  
```bash
iptables -A INPUT -j LOG --log-prefix "IPTables-Dropped: " --log-level 4
```
Drop all other incoming traffic:  
```bash
iptables -A INPUT -j DROP
```

---

## **9Ô∏è‚É£ Deleting and Modifying Rules**
Delete a specific rule (Example: Rule 6 from INPUT chain):  
```bash
iptables -D INPUT 6
```
Delete all rules from a specific chain:  
```bash
iptables -F INPUT
```
Insert a rule at a specific position:  
```bash
iptables -I INPUT 3 -p tcp --dport 8080 -j ACCEPT
```

---

## **üîü Saving and Restoring IPTables Rules**
Save rules so they persist after reboot:  
```bash
service iptables save
```
Or manually save them:  
```bash
iptables-save | sudo tee /etc/sysconfig/iptables
```
For IPv6:  
```bash
ip6tables-save | sudo tee /etc/sysconfig/ip6tables
```
Restore IPTables rules from saved file:  
```bash
iptables-restore < /etc/sysconfig/iptables
```

---

### **‚úÖ Final Checks**
Reboot the system and verify IPTables is running:  
```bash
sudo reboot
```
After reboot, check if the rules are still applied:  
```bash
iptables -L -n -v
```

---
