
# üêô Squid Proxy Server Setup on Kali Linux / Debian / Ubuntu

### **What is Squid Proxy Server (in short)?**

**Squid** is a caching and forwarding **HTTP proxy server** that improves web performance by **caching** frequently requested web content and controlling access to the internet. It supports HTTP, HTTPS, FTP, and more.

---

### **Where is Squid Proxy Used?**

- **Organizations & Enterprises** ‚Äì to restrict, monitor, and speed up employee internet usage.  
- **Schools & Universities** ‚Äì for internet access control and content filtering.  
- **Home networks** ‚Äì for parental control or bandwidth savings.  
- **ISPs** ‚Äì to reduce bandwidth by caching popular sites.

---

## 1. Check Repositories and Existing Installation

1. **Update package lists**
   ```bash
    apt update
   ```

2. **Check if Squid is already installed**
   ```bash
   dpkg -l | grep squid
   ```

---

## 2. Install Squid

1. **Install the Squid proxy package**
   ```bash
    apt install -y squid
   ```

---

## 3. Verify Installation

1. **Confirm Squid is installed**
   ```bash
   dpkg -l | grep squid
   ```

2. **Show detailed information**
   ```bash
   apt show squid
   ```

3. **List configuration files**
   ```bash
   dpkg -L squid | grep '\.conf'
   ```

4. **List documentation files**
   ```bash
   dpkg -L squid | grep 'doc'
   ```

5. **List all installed files**
   ```bash
   dpkg -L squid
   ```

---

## 4. Edit Squid Configuration

1. **Open the main config file**
   ```bash
    nano /etc/squid/squid.conf
   ```

2. **Example: allow only internal network**
   ```conf
   acl localnet src 192.168.1.0/24
   http_access allow localnet
   ```

3. **Ensure Squid listens on port 3128**
   ```conf
   http_port 3128
   ```

> Customize ACLs, logging, caching, or authentication as required.

---

## 5. Manage Squid Service

1. **Enable Squid at boot**
   ```bash
    systemctl enable squid
   ```

2. **Start or restart Squid**
   ```bash
    systemctl restart squid
   ```

3. **Check Squid status**
   ```bash
    systemctl status squid
   ```

---

## 6. Verify Squid Is Listening

1. **Using `netstat` (install if needed)**
   ```bash
    apt install -y net-tools
    netstat -tulpn | grep squid
   ```

2. **Using `ss`**
   ```bash
    ss -tulpn | grep squid
   ```

> You should see Squid listening on `0.0.0.0:3128`.

---

## 7. Configure UFW Firewall

1. **Check UFW status**
   ```bash
    ufw status
   ```

2. **Enable UFW if not already active**
   ```bash
    ufw enable
   ```

3. **Allow Squid port (3128)**
   ```bash
    ufw allow 3128/tcp
   ```

4. **(Optional) Allow DNS if required**
   ```bash
    ufw allow 53/tcp
    ufw allow 53/udp
   ```

5. **Reload and verify UFW rules**
   ```bash
    ufw reload
    ufw status verbose
   ```

---

## 8. Monitor Logs and Traffic

1. **Follow Squid access log**
   ```bash
    tail -f /var/log/squid/access.log
   ```

2. **Capture packets (change interface accordingly)**
   ```bash
    tcpdump -i eth1 -w /root/squid_traffic.pcap
   ```

3. **Read captured traffic**
   ```bash
    tcpdump -r /root/squid_traffic.pcap
   ```

---

### üßæ **Conclusion**

Squid Proxy Server on Kali/Ubuntu/Debian provides:

- **Improved performance** via caching  
- **Access control & security** through ACLs  
- **Traffic monitoring** via logs and filters  
- **Bandwidth optimization** for constrained networks  

---

# Proxy Server with Dual Network Interface  
*Configuration and Conceptual Workflow*

---

## 1. Bridged Adapter on Proxy Server OS  
![Dual Interface ‚Äì Bridged Adapter](https://github.com/nikhilpatidar01/Linux-Server/blob/Master/Proxy%20Server/CentOS/Configuration%20Images/1.%20Dual%20Interface%20Brighe%20Adaptor%20on%20Proxy%20server.png)  
- **eth0 (External):** Host-connected via bridge or NAT  
- **eth1 (Internal):** Internal-only network for clients

---

## 2. Internal Network IP Plan  
![Dual Interface ‚Äì Internal Network](https://github.com/nikhilpatidar01/Linux-Server/blob/Master/Proxy%20Server/CentOS/Configuration%20Images/2.%20Dual%20Interface%20Internal%20Network%20on%20%20Proxy%20server.png)  
- **Proxy eth0 (External):** e.g. `192.168.95.145`  
- **Proxy eth1 (Internal):** `192.168.1.1/24`  
- **Client PC:** `192.168.1.2/24`, GW `192.168.1.1`

---

## 3. Assign IP to Proxy‚Äôs Internal Interface  
![Set IP on 2nd Interface](https://github.com/nikhilpatidar01/Linux-Server/blob/Master/Proxy%20Server/CentOS/Configuration%20Images/3.%20Set%20IP%202nd%20Interface%20on%20Proxy%20Server.png)  
```bash
 ip addr add 192.168.1.1/24 dev eth1
 ip link set eth1 up
```

---

## 4. Client PC Network Setup  
![Client Internal Network Settings](https://github.com/nikhilpatidar01/Linux-Server/blob/Master/Proxy%20Server/CentOS/Configuration%20Images/4.%20Client%20PC%20Internal%20Network%20Set.png)  
![Client IP Set in Windows](https://github.com/nikhilpatidar01/Linux-Server/blob/Master/Proxy%20Server/CentOS/Configuration%20Images/5.%20Set%20IP%20Client%20PC.png)  
- IP: `192.168.1.10`  
- Subnet: `255.255.255.0`  
- Gateway: `192.168.1.1`

---

## 5. Ping Tests  
![Ping Tests](https://github.com/nikhilpatidar01/Linux-Server/blob/Master/Proxy%20Server/CentOS/Configuration%20Images/6.%20Client%20PC%20to%20Ping%20Proxy%20Server%20ip%20not%20Other%20IP%20Pinging.png)  
- ‚úÖ `ping 192.168.1.1` works  
- ‚ùå `ping 8.8.8.8` fails (no forwarding yet)

---

## 6. Browser Proxy Settings  
![Browser Proxy Settings](https://github.com/nikhilpatidar01/Linux-Server/blob/Master/Proxy%20Server/CentOS/Configuration%20Images/7.%20Proxy%20Server%20IP%20and%20Port%20Set%20Client%20PC%20Browser.png)  
In Windows ‚Üí Network ‚Üí Proxy Settings:  
- **Proxy Enabled:** Yes  
- **Address:** `192.168.1.1`  
- **Port:** `3128`

---

## 7. Conceptual Traffic Flow  
![Conceptual Diagram](https://github.com/nikhilpatidar01/Linux-Server/blob/Master/Proxy%20Server/CentOS/Configuration%20Images/8.%20Proxy%20Server%20Work%20Diagram.png)  
```text
Client ‚Üí Proxy (eth1) ‚Üí Proxy (eth0) ‚Üí Internet
```

---

## üîß Next Steps

1. Install & configure Squid with internal ACLs (`192.168.1.0/24`)  
2. Enable IP forwarding:
   ```bash
   echo 1 |  tee /proc/sys/net/ipv4/ip_forward
    sysctl -w net.ipv4.ip_forward=1
   ```
3. Set up NAT using `iptables` (if acting as a gateway):
   ```bash
    iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
   ```

4. Save iptables rules if needed (using `iptables-persistent`).

---
