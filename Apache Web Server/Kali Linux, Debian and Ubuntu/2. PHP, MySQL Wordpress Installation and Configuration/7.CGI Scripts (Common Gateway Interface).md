
# CGI Scripts (Common Gateway Interface) On Kali Linux / Ubuntu / Debian-based systems.

**CGI (Common Gateway Interface)** is a standard protocol used to run external programs or scripts on a web server to generate dynamic web content. These scripts can be written in various languages like **Python, Perl, PHP**, or **Shell**, and are commonly used to deliver dynamic content based on user input.

---

## How CGI Works

### Client Request
```text
A user accesses a CGI-enabled URL by clicking a link or submitting a form.
```

### Server Execution
```text
The web server runs the CGI script located in the `cgi-bin` directory.
```

### Dynamic Response
```text
The script processes any input and sends a dynamically generated HTML response to the client.
```

---

## Supported Technologies

- **Perl** – Historically common for web scripting.
- **Python** – Readable and easy to maintain.
- **PHP** – Widely used for web development (though not strictly CGI).
- **Ruby** – Flexible and dynamic.
- **Shell Scripts** – Useful for small utilities and server-side tasks.

---

## Installation and Configuration Steps

### Install Apache
```bash
sudo apt update
```
```bash
sudo apt install apache2
```

### Install Perl and CGI Module
```bash
sudo apt install perl libcgi-pm-perl
```

### Enable CGI Module in Apache
```bash
sudo a2enmod cgi
```

### Restart Apache
```bash
sudo systemctl restart apache2
```

### Check CGI Module
```bash
apache2ctl -M | grep cgi
```

---

## Apache Configuration

### Edit Apache Configuration
```bash
sudo nano /etc/apache2/sites-available/000-default.conf
```

### Add or Modify the CGI Script Directory Block
Find the CGI line and add some data.
```apache
<Directory "/usr/lib/cgi-bin">
    AllowOverride None
    Options +ExecCGI
    AddHandler cgi-script .cgi .py .sh
    Require all granted
</Directory>
```

### Restart Apache Again
```bash
sudo systemctl restart apache2
```

---

## Creating and Deploying CGI Scripts

### Create a Simple CGI Script (Perl)
```bash
sudo nano /usr/lib/cgi-bin/test.cgi
```

```perl
#!/usr/bin/perl
print "Content-type: text/html\n\n";
print "<pre>";
print "Memory";
print "</pre>";
```

### Set Ownership and Permissions
```bash
sudo chown www-data:www-data /usr/lib/cgi-bin/test.cgi
sudo chmod 755 /usr/lib/cgi-bin/test.cgi
```

### Browse in Browser
```
http://localhost/cgi-bin/test.cgi
```

---

## Additional CGI Scripts

### Create `mem.cgi`
```bash
sudo nano /usr/lib/cgi-bin/mem.cgi
```

```bash
#!/bin/bash
echo "Content-type: text/html"
echo
echo "<pre>Memory Usage:"
free -h
echo "</pre>"
```

### Set Ownership and Permissions
```bash
sudo chown www-data:www-data /usr/lib/cgi-bin/mem.cgi
sudo chmod 755 /usr/lib/cgi-bin/mem.cgi
```

---

### Create `ping.cgi`
```bash
sudo nano /usr/lib/cgi-bin/ping.cgi
```

```bash
#!/bin/bash
echo "Content-type: text/html"
echo
echo "<pre>Ping the Server:"
ping -c 4 8.8.8.8
echo "</pre>"
```

### Set Ownership and Permissions
```bash
sudo chown www-data:www-data /usr/lib/cgi-bin/ping.cgi
sudo chmod 755 /usr/lib/cgi-bin/ping.cgi
```

### Access in Browser
```
http://localhost/cgi-bin/ping.cgi
```

---

## Other Sample Scripts

### Create `script.cgi`
```bash
sudo nano /usr/lib/cgi-bin/script.cgi
sudo chmod +x /usr/lib/cgi-bin/script.cgi
ls -lh /usr/lib/cgi-bin/script.cgi
```

---

### Create `script2.cgi`
```bash
sudo nano /usr/lib/cgi-bin/script2.cgi
sudo chmod +x /usr/lib/cgi-bin/script2.cgi
ls -lh /usr/lib/cgi-bin/script2.cgi
```

---

## Python Script Example – `hello1.cgi`

### Create Script
```bash
sudo nano /usr/lib/cgi-bin/hello1.cgi
```

```python
#!/usr/bin/python3
print("Content-type: text/html\n")
print("<h1>Hello, CGI</h1>")
```

### Make Executable
```bash
sudo chmod +x /usr/lib/cgi-bin/hello1.cgi
```

### List Script
```bash
ls -lh /usr/lib/cgi-bin/hello1.cgi
```

### Browse in Browser
```
http://localhost/cgi-bin/hello1.cgi
```

---

## Securing the `cgi-bin` Directory

### Restrict Access to Authenticated Users

To enhance security, limit access to CGI scripts to authenticated users only.

### Step 1: Enable `auth_basic` module
```bash
sudo a2enmod auth_basic
```

### Step 2: Edit Apache Configuration
```bash
sudo nano /etc/apache2/sites-available/000-default.conf
```

### Step 3: Add or Modify Directory Block
```apache
<Directory "/usr/lib/cgi-bin">
    AllowOverride None
    Options +ExecCGI
    AddHandler cgi-script .cgi .pl .py .sh
    AuthType Basic
    AuthName "Nikhil CGI"
    AuthUserFile /etc/apache2/.htpasswd
    Require valid-user
</Directory>
```

### Step 4: Create the Authentication File

#### First User:
```bash
sudo htpasswd -c /etc/apache2/.htpasswd username
```

#### Additional Users:
```bash
sudo htpasswd /etc/apache2/.htpasswd anotheruser
```

### Step 5: Restart Apache
```bash
sudo systemctl restart apache2
```

### Access in Browser
```
http://localhost/cgi-bin/hello1.cgi
```

#### Enter Username and Password
```
Username: Nikhil
Password: 123
```

---
