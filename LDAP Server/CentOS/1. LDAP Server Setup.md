
# LDAP Server Setup (CentOS 9)

## Disable IPv6

To disable IPv6 on CentOS 9:

### 1. Edit the GRUB configuration

```bash
vi /etc/default/grub
```

Add this to the `GRUB_CMDLINE_LINUX` line:

```bash
ipv6.disable=1
```

Then regenerate GRUB and reboot:

```bash
grub2-mkconfig -o /boot/grub2/grub.cfg
reboot
```

### 2. Or disable via sysctl

```bash
vi /etc/sysctl.conf
```

Add the following:

```ini
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
```

Apply changes immediately:

```bash
sysctl -p
```

---

## Configure DNS Server with BIND9

### Install BIND9

BIND9 is available in CentOS repositories.

Install BIND and its utilities:

```bash
yum install bind bind-utils -y
```

Enable and start the service:

```bash
systemctl enable named
systemctl start named
```

---

## Configure DNS Zone

### Edit main configuration

```bash
vim /etc/named.conf
```

Add ACL for your network:

```ini
acl mynetwork {
    127.0.0.1;
    192.168.1.0/24;
    192.168.2.0/24;
};
```

### Define a new zone

Edit the zone configuration:

```bash
vim /etc/named.rfc1912.zones
```

Add:

```ini
zone "armour.local" IN {
    type master;
    file "forward.armour.local";
    allow-update { none; };
};
```

---

## Create Zone File

```bash
vim /var/named/forward.armour.local
```

Example:

```ini
$TTL 86400
@   IN  SOA ns1.armour.local. root.armour.local. (
        20250313    ; Serial
        3600        ; Refresh
        1800        ; Retry
        604800      ; Expire
        86400       ; Minimum TTL
)

; Name Servers
    IN  NS  ns1.armour.local.
    IN  NS  ns2.armour.local.

; A Records
ns1             IN  A   192.168.1.34
ns2             IN  A   192.168.1.38
ldap            IN  A   192.168.1.34
armour.local.   IN  A   192.168.1.34
router          IN  A   192.168.1.1
gateway         IN  A   192.168.1.200
alt             IN  A   192.168.1.208

; Mail
@               IN  MX  10 mail.armour.local.
mail            IN  A   192.168.1.150

; SPF TXT record
@               IN  TXT "v=spf1 mx a ~all"

; Additional Services
ftp             IN  CNAME armour.local.
dev             IN  A   192.168.1.100
fileserver      IN  A   192.168.1.110
db              IN  A   192.168.1.120
test            IN  A   192.168.1.130
vpn             IN  A   192.168.1.140
```

---

### Add Additional Zone

Add in `/etc/named.conf`:

```conf
zone "server.local" IN {
    type master;
    file "/etc/named/server.local.zone";
    allow-update { none; };
};
```

---

### Set Proper Permissions

```bash
chgrp named /var/named/forward.armour.local
```

---

### Restart BIND Service

```bash
systemctl restart named
```

---

### Allow DNS Through Firewall

```bash
firewall-cmd --add-service=dns --permanent
firewall-cmd --reload
```

---

# Configure LDAP Server

## Install OpenLDAP Services

```bash
yum install openldap-servers openldap-clients -y
```

---

## Check LDAP Packages (Optional)

```bash
rpm -ql openldap-servers
rpm -qd openldap-servers
rpm -qc openldap-servers
```

---

## Enable and Start `slapd`

```bash
systemctl enable slapd
systemctl start slapd
```

---

## Configure LDAP Backend

### Generate Root Password

```bash
slappasswd
```

Example Output:

```bash
{SSHA}rNIKA1XloAE18
```

---

### Create Basic Configuration LDIF File

```bash
vim db_config.ldif
```
---


---

### Create a Basic Configuration LDIF File

```bash
vi db_config.ldif
```

**Example contents:**

```ini
dn: olcDatabase={2}mdb,cn=config
changetype: modify
replace: olcSuffix
olcSuffix: dc=example,dc=com

dn: olcDatabase={2}mdb,cn=config
changetype: modify
replace: olcRootDN
olcRootDN: cn=Manager,dc=example,dc=com

dn: olcDatabase={2}mdb,cn=config
changetype: modify
replace: olcRootPW
olcRootPW: {SSHA}rNIKA1XloAE18DhhYWCi2QBIEEDdGeL
```

> Replace `dc=example,dc=com` and `cn=Manager` as per your domain and LDAP admin.

---

### Apply the Configuration

```bash
ldapmodify -Y EXTERNAL -H ldapi:/// -f db_config.ldif
```

---

