# Step-by-Step Guide for Configuring LDAP on a Debian-Based Linux Server and Client

This guide includes setup instructions for LDAP along with DNS, SSH, and FTP access for LDAP user home directory login.
---

**LDAP (Lightweight Directory Access Protocol)** is an open, vendor-neutral protocol used to access and manage directory information over a network. A directory in this context is a hierarchical database optimized for reading, searching, and managing information about users, groups, systems, and resources.

---

## ðŸ“Œ Preliminary Steps

Before starting the configuration, update the hostname:

```bash
hostnamectl set-hostname ns.server.local
reboot
````

> âš ï¸ You can change the domain according to your requirements.

* **Domain used:** `server.local`
* **LDAP Server IP:** `192.168.169.130`
* **LDAP Client IP:** `192.168.169.145`

> ðŸ’¡ It is preferred to use **static IP addresses** for both client and server.

For theoretical understanding of LDAP, refer to:
ðŸ”— [What is LDAP - JumpCloud](https://jumpcloud.com/blog/what-is-ldap)

---

## ðŸ“š Table of Contents

1. [Configuration of DNS](#1-configuration-of-dns)
2. [LDAP Server Configuration](#2-ldap-server-configuration)
3. [LDAP Client Setup](#3-ldap-client)
4. [SSH Access for LDAP Users](#4-making-ssh-connection-by-using-ldap-authentication-users)
5. [FTP Access for LDAP Users](#5-ftp-configuration-and-login-with-ldap-authentication-users)
6. [Conclusion](#6-conclusion)

---

# 1. Configuration of DNS

We will configure the DNS server to create records for the LDAP domain. This will be used when connecting from the client to the LDAP server.

---

### ðŸ”§ Step 1 â€” Install DNS Required Packages

```bash
apt install bind9 dnsutils
```

---

### ðŸ”§ Step 2 â€” Create Zone in `/etc/bind/named.conf.local`

```bash
vim /etc/bind/named.conf.local
```

This creates a DNS zone for `server.local`, which will be used to store DNS records for the domain.

---

### ðŸ”§ Step 3 â€” Create Forward Zone Records

```bash
mkdir /etc/bind/zones
vim /etc/bind/zones/forward.server.local
```

Create the records for LDAP inside `forward.server.local`.

---

### ðŸ”§ Step 4 â€” (Optional) Update `/etc/hosts`

```bash
vim /etc/hosts
```

Add your desired entries if necessary (optional step).

---

### ðŸ”§ Step 5 â€” Restart DNS Services

```bash
systemctl restart bind9
systemctl enable named.service
```

---

### ðŸ”§ Step 6 â€” Verify Domain Resolution

```bash
nslookup server.local 192.168.169.130
nslookup ldap.server.local 192.168.169.130
```

âœ… **Expected Output:**

```bash
root@ns# nslookup server.local 192.168.169.130
Server:         192.168.169.130
Address:        192.168.169.130#53

Name:   server.local
Address: 192.168.169.130

root@ns# nslookup ldap.server.local 192.168.169.130
Server:         192.168.169.130
Address:        192.168.169.130#53

Name:   ldap.server.local
Address: 192.168.169.130
```

---

### ðŸ› ï¸ Optional: Update `/etc/resolv.conf`

```bash
vim /etc/resolv.conf
```

```bash
nameserver 192.168.169.135  # add this line
nameserver 8.8.8.8
```

---

âœ… **All Done with DNS**. Now we are ready for LDAP configuration.

---

# 2. LDAP (Lightweight Directory Access Protocol) Server Configuration

---

### ðŸ”§ Step 1 â€” Install Required LDAP Server Packages

`slapd` and `ldap-utils` are packages related to OpenLDAP.

```bash
apt install slapd ldap-utils
````

> During installation, it will ask:

* Administrator Password: `<yourpassword>`
  *(Note: A default Admin user is created with full privileges.)*

---

### ðŸ”§ Step 2 â€” Reconfigure LDAP

```bash
dpkg-reconfigure slapd
```

Answer the prompts:

* Omit OpenLDAP server configuration? â†’ `No`
* DNS Domain Name â†’ `server.local`
* Organization name â†’ `server`
* Administrator Password â†’ `<yourpassword>`
* Confirm Password â†’ `<yourpassword>`
* Do you want the database removed when slapd is purged? â†’ `No`
* Move old database? â†’ `Yes`

---

### ðŸ”§ Step 3 â€” Edit `/etc/ldap/ldap.conf`

Add the following two lines:

```bash
vim /etc/ldap/ldap.conf
```

```bash
BASE dc=server,dc=local
URI ldap://ldap.server.local
```

Explanation:

* `URI ldap://ldap.server.local` â€” tells the client tools to connect to the LDAP server.
* `BASE dc=server,dc=local` â€” sets the default search base for LDAP queries.

---

### âœ… Optional LDAP Configuration Checks

#### a) Check LDAP Configuration

```bash
ldapsearch -Q -LLL -Y EXTERNAL -H ldapi:/// -b cn=config dn
```

**Output:**

```bash
dn: cn=config
dn: cn=module{0},cn=config
dn: cn=schema,cn=config
dn: cn={0}core,cn=schema,cn=config
dn: cn={1}cosine,cn=schema,cn=config
dn: cn={2}nis,cn=schema,cn=config
dn: cn={3}inetorgperson,cn=schema,cn=config
dn: olcDatabase={-1}frontend,cn=config
dn: olcDatabase={0}config,cn=config
dn: olcDatabase={1}mdb,cn=config
```

#### b) Search LDAP for DNs

```bash
ldapsearch -x -LLL -H ldap:/// -b dc=server,dc=local dn
```

**Output:**

```bash
dn: dc=server,dc=local
```

#### c) Anonymous Bind Test

```bash
ldapwhoami -x
```

**Output:**

```bash
anonymous
```

#### d) Authenticated Bind as Admin

```bash
ldapwhoami -x -D cn=admin,dc=server,dc=local -W
```

**Output:**

```bash
dn:cn=admin,dc=server,dc=local
```

#### e) Check Identity via Unix Socket (run as root)

```bash
ldapwhoami -Y EXTERNAL -H ldapi:/// -Q
```

**Output (as root):**

```bash
dn:gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
```

---

### ðŸ”§ Step 4 â€” Create and Populate `users.ldif`

```bash
vim users.ldif
```

```ldif
dn: ou=People,dc=server,dc=local
objectClass: organizationalUnit
ou: People

dn: ou=Groups,dc=server,dc=local
objectClass: organizationalUnit
ou: Groups

dn: cn=teams,ou=Groups,dc=server,dc=local
objectClass: posixGroup
cn: teams
gidNumber: 5000

dn: uid=nikhil,ou=People,dc=server,dc=local
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: top
uid: nikhil
sn: patidar
givenName: nikhil
cn: nikhil patidar
displayName: nikhil patidar
uidNumber: 10000
gidNumber: 5000
userPassword:
gecos: nikhil patidar
loginShell: /bin/bash
homeDirectory: /home/nikhil
```

---

### ðŸ”§ Step 5 â€” Add Users and Groups to LDAP

```bash
ldapadd -x -D cn=admin,dc=server,dc=local -W -f users.ldif
```

**Output:**

```bash
Enter LDAP Password:
adding new entry "ou=People,dc=server,dc=local"
adding new entry "ou=Groups,dc=server,dc=local"
adding new entry "cn=teams,ou=Groups,dc=server,dc=local"
adding new entry "uid=nikhil,ou=People,dc=server,dc=local"
```

Verify using ldapsearch:

```bash
ldapsearch -x -LLL -b dc=server,dc=local '(uid=nikhil)' cn gidNumber
```

**Output:**

```bash
dn: uid=nikhil,ou=People,dc=server,dc=local
cn: nikhil patidar
gidNumber: 5000
```

---

### ðŸ”§ Step 6 â€” Set User Password Using `ldappasswd`

```bash
ldappasswd -x -D cn=admin,dc=server,dc=local -W -S uid=nikhil,ou=people,dc=server,dc=local
```

> Enter:

* New password
* Re-enter new password
* Admin LDAP password

---

### ðŸ”§ Step 7 â€” Edit PAM Auth File

```bash
vim /etc/pam.d/common-auth
```

Add this line:

```text
auth sufficient pam_ldap.so
```

---

### ðŸ”§ Step 8 â€” Enable Home Directory Creation

```bash
vim /etc/pam.d/common-session
```

Add:

```text
session required pam_mkhomedir.so skel=/etc/skel/ umask=0022
```

---

### ðŸ”§ Step 9 â€” Install Required LDAP PAM Packages

```bash
apt install nslcd libpam-ldapd
```

> During installation:

* LDAP server URI: `ldap://ldap.server.local`
* LDAP server search base: `dc=server,dc=local`
* Name service to configure: select `passwd`, `group`, `shadow`

---

### ðŸ”§ Step 10 â€” Add Admin Credentials to `/etc/nslcd.conf`

```bash
vim /etc/nslcd.conf
```

Add:

```conf
binddn cn=admin,dc=server,dc=local
bindpw <admin-password>
```

---

### ðŸ”§ Step 11 â€” Restart `nslcd` Service

```bash
systemctl restart nslcd.service
```

---

### âœ… Verify LDAP User Authentication

Check if LDAP user is recognized by system:

```bash
getent passwd nikhil
```

**Output:**

```bash
nikhil:*:10000:5000:nikhil patidar:/home/nikhil:/bin/bash
```

```bash
id nikhil
```

**Output:**

```bash
uid=10000(nikhil) gid=5000(teams) groups=5000(teams)
```

---

